# ì±„íŒ…ì•± ë§Œë“¤ê¸° Day 7 - í´ë¼ì´ì–¸íŠ¸ ë° ì„œë²„ êµ¬í˜„ - 6

ìƒì„±ì¼: 2025ë…„ 3ì›” 31ì¼ ì˜¤í›„ 4:36

ì‘ì„±ì¼: 25.03.31

## 1. êµ¬í˜„í•œ ê¸°ëŠ¥

- ë¡œê·¸ì¸ (ì‹œíë¦¬í‹° x) êµ¬í˜„
- ì±„íŒ…ë°© ë¦¬ìŠ¤íŠ¸(ì±„íŒ…ë°© ìƒì„± ë° ì±„íŒ…ë°© ì ‘ì†) êµ¬í˜„
- ì±„íŒ… ì„œë²„(ChatServer í´ë˜ìŠ¤ë¥¼ ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤(bean ê°ì²´)ë¡œ ìƒì„±í•˜ë„ë¡ ë³€ê²½)

## 2. ì½”ë“œ

1. í´ë¼ì´ì–¸íŠ¸
    - ì½”ë“œ ë¦¬ìŠ¤íŠ¸
        
        ### ì±„íŒ…ì°½
        
        1. client.html
            - ì½”ë“œ ë³´ê¸°
                
                ```html
                <%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
                <%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
                <!DOCTYPE html>
                <html lang="ko">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>ì±„íŒ… ì• í”Œë¦¬ì¼€ì´ì…˜</title>
                    <link rel="stylesheet" href="/css/client.css">
                    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                </head>
                <body>
                    <!-- ë‹‰ë„¤ì„ ì„¤ì • ëª¨ë‹¬ -->
                <!--     <div id="nicknameModal" class="modal">
                        <div class="modal-content">
                            <h2>ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”</h2>
                            <input type="text" id="nicknameInput" placeholder="ë‹‰ë„¤ì„">
                            <button id="submitNickname" onclick="connectWebSocket()">í™•ì¸</button>
                        </div>
                    </div> -->
                    <div class="container">
                        <!-- ì‚¬ì´ë“œë°” - ì°¸ê°€ì ëª©ë¡ -->
                        <div class="sidebar">
                            <div class="user-profile">
                                <img src="default-avatar.png" alt="í”„ë¡œí•„" class="profile-img">
                                <span class="username" id="username">ì‚¬ìš©ì ì´ë¦„</span>
                            </div>
                            <h3>ì°¸ê°€ì ëª©ë¡</h3>
                            <ul class="participants-list" id="participantsList">
                                <!-- ì°¸ê°€ìë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                            </ul>
                        </div>
                
                        <!-- ë©”ì¸ ì±„íŒ… ì˜ì—­ -->
                        <div class="main-content">
                            <!-- ì±„íŒ…ë°© ì •ë³´ -->
                            <div class="chat-header">
                                <h2 id="roomName">${roomName}</h2>
                                <div class="chat-info">
                                    <span class="participant-count">ì°¸ê°€ì: </span>
                                    <span class="participant-count" id="userNumber">0</span>
                                </div>
                            </div>
                
                            <!-- ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ -->
                            <div class="chat-messages" id="chatMessages">
                                <!-- ë©”ì‹œì§€ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                            </div>
                
                            <!-- ë©”ì‹œì§€ ì…ë ¥ ì˜ì—­ -->
                            <div class="message-input-area">
                                <input type="text" id="messageInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
                                <button id="sendButton" onclick="sendMessage()">ì „ì†¡</button>
                                <button id="fileButton" class="file-button">ğŸ“</button>
                            </div>
                        </div>
                    </div>
                    <script src="/js/socket.js"></script>
                    <script src="/js/client.js"></script>
                </body>
                </html>
                ```
                
        2. client.css (ì´ì „ê³¼ ë™ì¼)
        3. client.js
            - ì½”ë“œ ë³´ê¸°
                
                ```jsx
                const USER = {
                	name: "user" + Math.random()
                }
                
                SOCKET.connect();
                
                SOCKET.init(
                	() => {
                		console.log("WebSocket ì—°ê²° ì„±ê³µ");
                	},
                	(event) => {
                		const json = JSON.parse(event.data);
                		if (json.hasOwnProperty("userNumber") && json.hasOwnProperty("userNames")) {
                			document.getElementById("userNumber").textContent = json.userNumber;
                
                			const participantsList = document.getElementById("participantsList");
                			let users = "";
                			json.userNames.forEach(name => {
                				if (name == USER.name) {
                					users += "<li class='participant'> ë‚˜: " + name + "</li>";
                				} else {
                					users += "<li>" + name + "</li>";
                				}
                			});
                			participantsList.innerHTML = users;
                			return;
                		}
                
                		if (json.hasOwnProperty("name") && json.hasOwnProperty("message")) {
                			const chatMessages = document.getElementById("chatMessages");
                			let newMessage = "<div class='message received'>" + json.name + ": " + json.message + "</div>";
                			chatMessages.innerHTML += newMessage;
                			return;
                		}
                	});
                
                function sendMessage() {
                	data = {};
                	data.message = document.getElementById("messageInput").value;  // ì…ë ¥ëœ ë©”ì‹œì§€ ê°€ì ¸ì˜¤ê¸°
                	SOCKET.socket.send(JSON.stringify(data));  // ë©”ì‹œì§€ ì „ì†¡
                	document.getElementById("messageInput").value = "";  // ì…ë ¥ì°½ ì´ˆê¸°í™”
                
                	let selfMessage = "<div class='message sent'>" + 'ë‚˜: ' + data.message + "</div>";
                	let chatMessages = document.getElementById("chatMessages");
                	chatMessages.innerHTML += selfMessage;
                }
                
                function connectWebSocket() {
                	const modal = document.getElementById('nicknameModal');
                	const nicknameInput = document.getElementById('nicknameInput');
                
                	const nickname = nicknameInput.value.trim();
                	if (nickname) {
                		// ë‹‰ë„¤ì„ì„ ì €ì¥í•˜ê³  ëª¨ë‹¬ ë‹«ê¸°
                		USER.name = nickname;
                		document.getElementById('username').textContent = nickname;
                		modal.style.display = 'none';
                	} else {
                		alert('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                	}
                
                	SOCKET.socket.send(JSON.stringify(USER));
                }
                ```
                
        
        ### ì±„íŒ…ë°© ë¦¬ìŠ¤íŠ¸
        
        1. roomlist.html
            - ì½”ë“œ ë³´ê¸°
                
                ```html
                <%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
                <%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
                <!DOCTYPE html>
                <html lang="ko">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>ì±„íŒ…ë°© ëª©ë¡</title>
                    <link rel="stylesheet" href="/css/roomlist.css">
                    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                </head>
                <body>
                    <div class="container">
                        <!-- ì‚¬ì´ë“œë°” - ì‚¬ìš©ì í”„ë¡œí•„ -->
                        <div class="sidebar">
                            <div class="user-profile">
                                <img src="default-avatar.png" alt="í”„ë¡œí•„" class="profile-img">
                                <span class="username" id="username">ì‚¬ìš©ì ì´ë¦„</span>
                            </div>
                        </div>
                
                        <!-- ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ -->
                        <div class="main-content">
                            <div class="rooms-header">
                                <h2>ì±„íŒ…ë°© ëª©ë¡</h2>
                                <button id="createRoomBtn">ìƒˆ ì±„íŒ…ë°© ë§Œë“¤ê¸°</button>
                            </div>
                
                            <!-- ì±„íŒ…ë°© ëª©ë¡ -->
                            <div class="room-list" id="roomList">
                            </div>
                        </div>
                    </div>
                
                    <!-- ìƒˆ ì±„íŒ…ë°© ìƒì„± ëª¨ë‹¬ -->
                    <div id="createRoomModal" class="modal">
                        <div class="modal-content">
                            <span class="close">&times;</span>
                            <h2>ìƒˆ ì±„íŒ…ë°© ë§Œë“¤ê¸°</h2>
                            <div class="input-group">
                                <label for="roomNameInput">ì±„íŒ…ë°© ì´ë¦„</label>
                                <input type="text" id="roomNameInput" placeholder="ì±„íŒ…ë°© ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                            </div>
                            <div class="modal-buttons">
                                <button id="submitRoom">ë§Œë“¤ê¸°</button>
                                <button id="cancelRoom">ì·¨ì†Œ</button>
                            </div>
                        </div>
                    </div>
                
                    <script src="/js/roomlist.js"></script>
                    <script src="/js/ajax.js"></script>
                </body>
                </html>
                ```
                
        2. roomlist.css
            - ì½”ë“œ ë³´ê¸°
                
                ```css
                .container {
                    display: flex;
                    height: 100vh;
                }
                
                .sidebar {
                    width: 250px;
                    background-color: #f5f5f5;
                    border-right: 1px solid #ddd;
                    padding: 20px;
                }
                
                .main-content {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                }
                
                .rooms-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 20px;
                    border-bottom: 1px solid #ddd;
                }
                
                .room-list {
                    flex: 1;
                    overflow-y: auto;
                    padding: 20px;
                }
                
                .room-item {
                    position: relative;
                    padding: 15px;
                    border-bottom: 1px solid #eee;
                    cursor: pointer;
                }
                
                .room-item:hover {
                    background-color: #f5f5f5;
                }
                
                .enter-btn {
                    position: absolute;
                    right: 15px;
                    top: 50%;
                    transform: translateY(-50%);
                    display: none;
                    padding: 8px 15px;
                    background-color: #4CAF50;
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                }
                
                .enter-btn:hover {
                    background-color: #45a049;
                }
                
                .room-item:hover .enter-btn {
                    display: block;
                }
                
                .room-info h3 {
                    margin: 0 0 5px 0;
                }
                
                .last-message {
                    color: #666;
                    font-size: 0.9em;
                    margin: 0;
                }
                
                .room-meta {
                    text-align: right;
                    font-size: 0.8em;
                    color: #888;
                }
                
                #createRoomBtn {
                    padding: 8px 16px;
                    background-color: #007bff;
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                }
                
                /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
                .modal {
                    display: none;
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0, 0, 0, 0.5);
                }
                
                .modal-content {
                    background-color: #fff;
                    margin: 15% auto;
                    padding: 20px;
                    border-radius: 8px;
                    width: 400px;
                    position: relative;
                }
                
                .close {
                    position: absolute;
                    right: 20px;
                    top: 10px;
                    font-size: 24px;
                    cursor: pointer;
                }
                
                .input-group {
                    margin-bottom: 15px;
                }
                
                .input-group label {
                    display: block;
                    margin-bottom: 5px;
                }
                
                .input-group input {
                    width: 100%;
                    padding: 8px;
                    border: 1px solid #ddd;
                    border-radius: 4px;
                }
                
                .modal-buttons {
                    display: flex;
                    justify-content: flex-end;
                    gap: 10px;
                    margin-top: 20px;
                }
                
                .modal-buttons button {
                    padding: 8px 16px;
                    border-radius: 4px;
                    cursor: pointer;
                }
                
                #submitRoom {
                    background-color: #4CAF50;
                    color: white;
                    border: none;
                }
                
                #cancelRoom {
                    background-color: #f44336;
                    color: white;
                    border: none;
                }
                ```
                
        3. roomlist.js
            - ì½”ë“œ ë³´ê¸°
                
                ```jsx
                // ëª¨ë‹¬ ê´€ë ¨ ìš”ì†Œë“¤
                const modal = document.getElementById('createRoomModal');
                const createRoomBtn = document.getElementById('createRoomBtn');
                const closeBtn = document.querySelector('.close');
                const submitBtn = document.getElementById('submitRoom');
                const cancelBtn = document.getElementById('cancelRoom');
                
                // ëª¨ë‹¬ ì—´ê¸°
                createRoomBtn.onclick = function() {
                	modal.style.display = "block";
                }
                
                // ëª¨ë‹¬ ë‹«ê¸° (X ë²„íŠ¼)
                closeBtn.onclick = function() {
                	modal.style.display = "none";
                }
                
                // ëª¨ë‹¬ ë‹«ê¸° (ì·¨ì†Œ ë²„íŠ¼)
                cancelBtn.onclick = function() {
                	modal.style.display = "none";
                }
                
                // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
                window.onclick = function(event) {
                	if (event.target == modal) {
                		modal.style.display = "none";
                	}
                }
                
                document.getElementById('username').innerText = sessionStorage.getItem('username');
                
                // ì±„íŒ…ë°© ìƒì„± ì œì¶œ
                submitBtn.onclick = function() {
                	const roomName = document.getElementById('roomNameInput').value;
                
                	if (!roomName) {
                		alert('ì±„íŒ…ë°© ì´ë¦„ê³¼ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                		return;
                	}
                
                	const roomInfo = {
                		name: roomName,
                	}
                
                	// ì—¬ê¸°ì— ì±„íŒ…ë°© ìƒì„± ë¡œì§ ì¶”ê°€
                	console.log('ì±„íŒ…ë°© ìƒì„±:', {
                		name: roomName,
                	});
                
                	// ëª¨ë‹¬ ë‹«ê¸° ë° ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                	modal.style.display = "none";
                	document.getElementById('roomNameInput').value = '';
                
                	// ì±„íŒ…ë°© ëª©ë¡ ì—…ë°ì´íŠ¸
                	const roomList = document.getElementById('roomList');
                
                	let roomItem = ''
                	roomItem += '<div class="room-item" id="roomItem">'
                	roomItem += '   <div class="room-info" id="roomInfo">'
                	roomItem += '       <h3>' + roomName + '</h3>'
                	roomItem += '   </div>'
                	roomItem += '   <div class="room-meta">'
                	roomItem += '       <span class="participant-count">5ëª…</span>'
                	roomItem += '   </div>'
                	roomItem += '</div>'
                
                	roomList.innerHTML += roomItem;
                	
                	data = {}
                	data.roomName = roomName;
                	data.name = sessionStorage.getItem('username');
                	common.sendAjax('post', '/api/createRoom', data, function(response, xhr) {
                		console.log(response);
                	});
                
                	document.getElementById("roomItem").addEventListener("click", function() {
                		window.location.href = '/webview/chat/rooms?roomName=' + roomName;
                	});
                }
                ```
                
        
        ### ë¡œê·¸ì¸
        
        1. login.html
            - ì½”ë“œ ë³´ê¸°
                
                ```html
                <%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
                <%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
                <!DOCTYPE html>
                <html lang="ko">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>CK Talk</title>
                    <link rel="stylesheet" href="/css/login.css">
                    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                </head>
                <body>
                    <div class="login-container">
                        <div class="login-box">
                            <div class="app-header">
                                <img src="/images/ckInfo2.png" alt="ì±„íŒ… ì•± ë¡œê³ " class="app-logo">
                                <h1 class="app-title">CK Talk</h1>
                            </div>
                            <form id="loginForm" class="login-form">
                                <div class="input-group">
                                    <label for="userId">ì•„ì´ë””</label>
                                    <input type="text" id="userId" name="userId" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                                </div>
                                <div class="input-group">
                                    <label for="userPassword">ë¹„ë°€ë²ˆí˜¸</label>
                                    <input type="password" id="userPassword" name="userPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                                </div>
                                <button type="submit" class="login-button">ë¡œê·¸ì¸</button>
                            </form>
                        </div>
                    </div>
                    <script src="/js/ajax.js"></script>
                    <script src="/js/login.js"></script>
                </body>
                </html>
                ```
                
                - ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì´ë™ í•  url ìˆ˜ì •
        2. login.css (ì´ì „ê³¼ ë™ì¼)
        3. login.js
            - ì½”ë“œ ë³´ê¸°
                
                ```jsx
                document.getElementById('loginForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const userId = document.getElementById('userId').value;
                    const userPassword = document.getElementById('userPassword').value;
                    
                    // ì—¬ê¸°ì— ë¡œê·¸ì¸ ê²€ì¦ ë¡œì§ì„ ì¶”ê°€í•˜ì„¸ìš”
                    console.log('ë¡œê·¸ì¸ ì‹œë„:', {
                        userId: userId,
                        password: userPassword
                    });
                    
                    data = {}
                    data.name = userId;
                    data.password = userPassword;
                    common.sendAjax('post', '/api/login', data, function(response, xhr) {
                		// ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì±„íŒ…ë°© ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™
                		sessionStorage.setItem("username", userId);
                    	window.location.href = '/webview/chat';
                	})
                });
                ```
                
                - ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì´ë™ í•  url ìˆ˜ì •
        
        ### ì†Œì¼“
        
        1. socket.js
            - ì½”ë“œ ë³´ê¸°
                
                ```jsx
                const SOCKET = {
                    socket: null,
                    address: null,
                
                    connect: function(roomName) {
                		SOCKET.address = 'ws://127.0.0.1:8081/chat/' + roomName;
                        SOCKET.socket = new WebSocket(this.address);  // ì†Œì¼“ ì—°ê²°
                    },
                    
                    init: function(onopen, onmessage, onclose) {
                		SOCKET.socket.onopen = onopen;
                        SOCKET.socket.onmessage = onmessage;
                        SOCKET.socket.onclose = onclose;
                	},
                }
                ```
                
                - ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì´ë™ í•  url ìˆ˜ì •
2. ì„œë²„
    - ì½”ë“œ ë¦¬ìŠ¤íŠ¸
        
        ## Socket
        
        1. ChatServer.java
            - ì½”ë“œ ë³´ê¸°
                
                ```java
                package chat.socket;
                
                import java.io.IOException;
                import java.util.HashMap;
                import java.util.List;
                import java.util.Map;
                
                import javax.websocket.OnClose;
                import javax.websocket.OnError;
                import javax.websocket.OnMessage;
                import javax.websocket.OnOpen;
                import javax.websocket.Session;
                import javax.websocket.server.PathParam;
                import javax.websocket.server.ServerEndpoint;
                
                import org.springframework.beans.factory.annotation.Autowired;
                
                import com.fasterxml.jackson.core.JsonProcessingException;
                import com.fasterxml.jackson.databind.ObjectMapper;
                
                import annotation.chat;
                import chat.socket.config.ChatServerConfig;
                
                @ServerEndpoint(value = "/chat/{roomName}", configurator = ChatServerConfig.class)
                @chat
                public class ChatServer {
                	
                	@Autowired
                	private ChattingRoomManager chattingRoomManager;
                
                    @OnOpen
                    public void onOpen(@PathParam("roomName") String roomName, Session session) throws IOException {
                        String clientAddress = session.getRequestURI().getHost();
                        int clientPort = session.getRequestURI().getPort();
                        System.out.println("ìƒˆ í´ë¼ì´ì–¸íŠ¸ ì—°ê²°ë¨: " + clientAddress + ":" + clientPort);
                
                        // í´ë¼ì´ì–¸íŠ¸ê°€ ì—°ê²°ë˜ì—ˆì„ ë•Œ ë©”ì‹œì§€ ì „ì†¡
                        Map<String, Object> map = new HashMap<>();
                        map.put("name", "ì„œë²„");
                        map.put("message", "ì„œë²„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤!");
                        sendMessage(session, map);
                    }
                
                    @OnClose
                    public void onClose(Session session) throws IOException {
                        System.out.println("í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ì¢…ë£Œ: " + session.getId());
                    }
                
                    @OnMessage
                    public void onMessage(Session session, String data) {
                        try {
                            Map<String, Object> message = jsonToMap(data);
                            String roomName = (String) message.get("roomName");
                            Room room = chattingRoomManager.getChattingRoom(roomName);
                
                            if (message.containsKey("name")) {	
                                List<User> users = chattingRoomManager.newClient(message, roomName, session);
                                Map<String, Object> participants = new HashMap<>();
                                participants.put("users", users);
                                sendToAll(users, participants);
                                return;
                            }
                
                            if (message.containsKey("message")) {
                                for (User user : room.getParticipatns()) {
                                    if (user.getSession() != session) {
                                    	message.put("name", user.getName());
                                        sendMessage(user.getSession(), message);
                                    }
                                }
                                return;
                            }
                            
                            if (message.containsKey("close")) {
                            	chattingRoomManager.removeUser(session, roomName);
                            }
                        } catch (Exception e) {
                            e.printStackTrace();
                            try {
                                session.getBasicRemote().sendText("ì˜ëª»ëœ í˜•ì‹ì˜ ë©”ì‹œì§€ì…ë‹ˆë‹¤.");
                            } catch (IOException ex) {
                                ex.printStackTrace();
                            }
                        }
                    }
                
                    @OnError
                    public void onError(Session session, Throwable throwable) {
                        throwable.printStackTrace();
                    }
                
                    // íŠ¹ì • ìœ ì €ì—ê²Œ ë©”ì‹œì§€ ì „ì†¡
                    private void sendMessage(Session session, Map<String, Object> message) throws IOException {
                        String jsonMessage = mapToJson(message);
                        session.getBasicRemote().sendText(jsonMessage);
                    }
                
                    // ëª¨ë“  ìœ ì €ì—ê²Œ ë©”ì‹œì§€ ì „ì†¡
                    private void sendToAll(List<User> users, Map<String, Object> message) {
                        for (User user : users) {
                            try {
                                sendMessage(user.getSession(), message);
                            } catch (IOException e) {
                                e.printStackTrace();
                            }
                        }
                    }
                
                    private Map<String, Object> jsonToMap(String json) {
                        try {
                            ObjectMapper objectMapper = new ObjectMapper();
                            return objectMapper.readValue(json, Map.class);
                        } catch (JsonProcessingException e) {
                            e.printStackTrace();
                            return new HashMap<>();
                        }
                    }
                
                    private String mapToJson(Map<String, Object> map) {
                        try {
                            ObjectMapper objectMapper = new ObjectMapper();
                            return objectMapper.writeValueAsString(map);
                        } catch (JsonProcessingException e) {
                            e.printStackTrace();
                            return "{}";
                        }
                    }
                }
                
                ```
                
                - ì›¹ì†Œì¼“ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë³€ê²½
                - ê·¸ëŸ¬ë‚˜, ì—¬ì „íˆ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í†µí•´ ì ‘ê·¼ ì‹œ í†µì‹  ë¶ˆê°€
        2. User.java
            - ì½”ë“œ ë³´ê¸°
                
                ```java
                package chat.socket;
                
                import javax.websocket.Session;
                
                public class User {
                //	private String id;
                //	private String password;
                    private String name;
                //    private String ip;
                //    private int port;
                    private Session session;
                    
                    public User(String name) {
                    	this.name = name;
                    }
                    
                    public User(String name, Session session) {
                    	this.name = name;
                    	this.session = session;
                    }
                
                //    public User(String name, String ip, int port) {
                //        this.name = name;
                //        this.ip = ip;
                //        this.port = port;
                //    }
                
                    // WebSocket ê°ì²´ë¥¼ ì¶”ê°€í•œ ìƒì„±ì
                //    public User(String name, String ip, int port, Session session) {
                //        this.name = name;
                //        this.ip = ip;
                //        this.port = port;
                //        this.session = session;
                //    }
                
                    public String getName() {
                        return name;
                    }
                    
                //    public String getIp() {
                //        return ip;
                //    }
                //    
                //    public int getPort() {
                //        return port;
                //    }
                
                    public Session getSession() {
                        return session;
                    }
                }
                
                ```
                
                - ì†Œì¼“ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë³€ê²½í•˜ë©´ì„œ ì´ë¦„í•˜ê³  ì„¸ì…˜ì •ë³´ë¥¼ ì…ë ¥í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³€ê²½
        3. ~~Chat.java(ì‚­ì œ)~~
        4. ~~ChatService.java(ì‚­ì œ)~~
        5. Room.java
            - ì½”ë“œ ë³´ê¸°
                
                ```java
                package chat.socket;
                
                import java.util.ArrayList;
                import java.util.Iterator;
                import java.util.List;
                
                public class Room {
                	
                	private int roomId;
                	
                	private String roomName;
                	
                	private String manager;
                	
                	private List<User> participants;
                	
                	private List<String> conversations;
                	
                	public Room(String roomName, String manager) {
                		this.roomName = roomName;
                		this.manager = manager;
                		this.participants = new ArrayList<>();
                	}
                	
                	public String getRoomName() {
                		return this.roomName;
                	}
                	
                	public String getManager() {
                		return this.manager;
                	}
                	
                	public List<User> getParticipatns() {
                		return this.participants;
                	}
                	
                	public List<String> getConversation() {
                		return this.conversations;
                	}
                	
                	public void addUser(User user) {
                		this.participants.add(user);
                	}
                	
                	public void removeUser(User user) {
                        Iterator<User> iterator = this.participants.iterator();
                        while (iterator.hasNext()) {
                        	User u = iterator.next();
                            if (u.getSession() == user.getSession()) {
                            	iterator.remove();
                            }
                        }
                	}
                }
                
                ```
                
                - ì†Œì¼“ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë³€ê²½í•˜ë©´ì„œ ì´ë¦„í•˜ê³  ì„¸ì…˜ì •ë³´ë¥¼ ì…ë ¥í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³€ê²½
        6. ChattingRoomManager.java
            - ì½”ë“œ ë³´ê¸°
                
                ```java
                package chat.socket;
                
                import java.util.ArrayList;
                import java.util.HashMap;
                import java.util.Iterator;
                import java.util.List;
                import java.util.Map;
                
                import javax.websocket.Session;
                
                import annotation.chat;
                
                @chat
                public class ChattingRoomManager {
                	
                	private Map<String, Room> rooms = new HashMap<>();
                
                	public Room getChattingRoom(String roomName) {
                		return rooms.get("roomName");
                	}
                	
                	public int createRoom(String roomName, Room room) {
                		rooms.put(roomName, room);
                		return rooms.size();
                	}
                	
                    // ìƒˆë¡œ ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸ê°€ ìˆëŠ” ê²½ìš°
                    public List<User> newClient(Map<String, Object> userInfo, String roomName, Session session) {
                        System.out.println("í´ë¼ì´ì–¸íŠ¸ ì´ë¦„: " + userInfo.get("name"));
                        String name = (String) userInfo.get("name");
                        User newUser = new User(name, session);
                        
                        System.out.println("rooms: " + rooms);
                        
                        Room room  = rooms.get(roomName);
                        room.addUser(newUser);
                
                        return room.getParticipatns();
                    }
                    
                    // ì—°ê²° ì¢…ë£Œëœ í´ë¼ì´ì–¸íŠ¸ê°€ ìˆëŠ” ê²½ìš°
                    public Map<String, Object> removeUser(Session session, String roomName) {
                        Map<String, Object> participation = new HashMap<>();
                        List<String> userNames = new ArrayList<>();
                        List<User> users = rooms.get(roomName).getParticipatns();
                        Iterator<User> iterator = users.iterator();
                        while (iterator.hasNext()) {
                            User u = iterator.next();
                            if (u.getSession() != session) {
                                userNames.add(u.getName());
                                continue;
                            }
                            iterator.remove();
                        }
                        participation.put("userNumber", users.size());
                        participation.put("userNames", userNames);
                        return participation;
                    }
                }
                
                ```
                
                - ì†Œì¼“ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë³€ê²½í•˜ë©´ì„œ ì´ë¦„í•˜ê³  ì„¸ì…˜ì •ë³´ë¥¼ ì…ë ¥í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³€ê²½
        7. ChatServerConfig.java
            - ì½”ë“œ ë³´ê¸°
                
                ```java
                package chat.socket.config;
                
                import javax.websocket.server.ServerEndpointConfig;
                
                import org.springframework.beans.factory.annotation.Autowired;
                import org.springframework.context.ApplicationContext;
                import org.springframework.context.annotation.Configuration;
                
                @Configuration
                public class ChatServerConfig extends ServerEndpointConfig.Configurator{
                
                	private static ApplicationContext context;
                	
                	@Autowired
                	public void setApplicationContext(ApplicationContext context) {
                		ChatServerConfig.context = context;
                	}
                	
                	@Override
                	public <T> T getEndpointInstance(Class<T> endpointClass) throws InstantiationException {
                		return context.getBean(endpointClass);
                	}
                }
                
                ```
                
        8. chat(annotation)
            - ì½”ë“œ ë³´ê¸°
                
                ```java
                package annotation;
                
                import java.lang.annotation.ElementType;
                import java.lang.annotation.Retention;
                import java.lang.annotation.RetentionPolicy;
                import java.lang.annotation.Target;
                
                import org.springframework.stereotype.Component;
                
                @Retention(RetentionPolicy.RUNTIME)
                @Target(ElementType.TYPE)
                @Component
                public @interface chat {
                
                }
                
                ```
                
        
        ## API
        
        1. ChatApiController
            - ì½”ë“œ ë³´ê¸°
                
                ```java
                package chat.api.controller;
                
                import java.util.HashMap;
                import java.util.Map;
                
                import javax.annotation.Resource;
                
                import org.springframework.http.HttpHeaders;
                import org.springframework.http.ResponseEntity;
                import org.springframework.web.bind.annotation.GetMapping;
                import org.springframework.web.bind.annotation.PostMapping;
                import org.springframework.web.bind.annotation.RequestBody;
                import org.springframework.web.bind.annotation.RequestMapping;
                import org.springframework.web.bind.annotation.ResponseBody;
                import org.springframework.web.bind.annotation.RestController;
                
                import chat.api.service.ChatApiService;
                
                @RestController
                @RequestMapping("/api")
                public class ChatApiController {
                
                	@Resource(name = "ChatApiService")
                	private ChatApiService chatApiService;
                
                	@GetMapping("/test")
                	public ResponseEntity<Map<String, Object>> hello() {
                		HttpHeaders headers = new HttpHeaders();
                		Map<String, Object> reuslt = chatApiService.test();
                		return ResponseEntity.ok().headers(headers).body(reuslt);
                	}
                	
                	@PostMapping("/login")
                	public ResponseEntity<Map<String, Object>> login(@RequestBody Map<String, Object> body) {
                		HttpHeaders headers = new HttpHeaders();
                		boolean login = chatApiService.login(body);
                		Map<String, Object> result = new HashMap<>();
                		if (!login) {
                			result.put("result", "ì‹¤íŒ¨");
                			result.put("rspCode", "2");
                			return ResponseEntity.ok().headers(headers).body(result);
                		}
                		
                		result.put("reuslt", "ì„±ê³µ");
                		result.put("rspCode", "1");
                		return ResponseEntity.ok().headers(headers).body(result);
                	}
                	
                	@PostMapping("/createRoom")
                	public ResponseEntity<Map<String, Object>> createRoom(@RequestBody Map<String, Object> body) {
                		System.out.println("ë°© ì •ë³´: " + body);
                		int roomNumber = chatApiService.createRoom(body);
                		HttpHeaders headers = new HttpHeaders();
                		Map<String, Object> result = new HashMap<>();
                		result.put("rspCode", "1");
                		result.put("roomNumber", roomNumber);
                		
                		return ResponseEntity.ok().headers(headers).body(result);
                	}
                }
                
                ```
                
        2. ChatApiService
            - ì½”ë“œ ë³´ê¸°
                
                ```java
                package chat.api.service;
                
                import java.util.Map;
                
                import chat.socket.User;
                
                public interface ChatApiService {
                
                	public Map<String, Object> test();
                
                	public int createRoom(Map<String, Object> body);
                
                	public boolean login(Map<String, Object> body);
                }
                
                ```
                
        3. ChatApiServiceImpl
            - ì½”ë“œ ë³´ê¸°
                
                ```java
                package chat.api.service.impl;
                
                import java.util.HashMap;
                import java.util.Map;
                
                import javax.annotation.Resource;
                
                import org.egovframe.rte.fdl.cmmn.EgovAbstractServiceImpl;
                import org.springframework.beans.factory.annotation.Autowired;
                import org.springframework.stereotype.Service;
                
                import chat.api.mapper.ChatApiMapper;
                import chat.api.service.ChatApiService;
                import chat.socket.ChattingRoomManager;
                import chat.socket.Room;
                import chat.socket.User;
                
                @Service("ChatApiService")
                public class ChatApiServiceImpl extends EgovAbstractServiceImpl implements ChatApiService{
                
                	@Resource(name = "ChatApiMapper")
                	private ChatApiMapper chatApiMapper;
                	
                	@Autowired
                	private ChattingRoomManager chattingRoomManager;
                
                	@Override
                	public Map<String, Object> test() {
                		Map<String, Object> map = chatApiMapper.test();
                		return map;
                	}
                	
                	@Override
                	public boolean login(Map<String, Object> body) {
                		Map<String, Object> map = chatApiMapper.getUser(body);
                		if (map == null) {
                			return false;
                		}
                		
                		return true;
                	}
                
                	@Override
                	public int createRoom(Map<String, Object> body) {
                		String name = (String) body.get("roomName");
                		User manager = new User((String) body.get("name"));
                		
                		Map<String, Object> param = new HashMap<>();
                		param.put("name", name);
                		param.put("manager", manager.getName());
                		chatApiMapper.createRoom(param);
                		
                        Room room = new Room(name, manager.getName());
                        room.addUser(manager);
                        int size = chattingRoomManager.createRoom(name, room);
                
                        return size;
                	}
                }
                
                ```
                
        4. ChatApiMapper
            - ì½”ë“œ ë³´ê¸°
                
                ```java
                package chat.api.mapper;
                
                import java.util.Map;
                
                import org.egovframe.rte.psl.dataaccess.mapper.Mapper;
                
                @Mapper("ChatApiMapper")
                public interface ChatApiMapper {
                
                	public Map<String, Object> test();
                	
                	public Map<String, Object> getUser(Map<String, Object> body);
                	
                	public void createRoom(Map<String, Object> param);
                
                }
                
                ```
                
        5. ChatApiMapper.xml
            - ì½”ë“œ ë³´ê¸°
                
                ```xml
                <?xml version="1.0" encoding="UTF-8" ?>
                <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
                	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
                 
                <mapper namespace="chat.api.mapper.ChatApiMapper">
                    <select id="test" resultType="map">
                        SELECT * 
                        FROM test
                    </select>
                    
                    <select id="getUser" resultType="map">
                    	SELECT *
                    	FROM users
                    	WHERE name = #{name} and password = #{password}
                    </select>
                    
                    <insert id="createRoom">
                    	INSERT INTO room (name, manager)
                    	VALUE (#{name}, #{manager});
                    </insert>
                </mapper>
                ```
                
        
        ## Webview
        
        1. ChatController
            - ì½”ë“œ ë³´ê¸°
                
                ```java
                package chat.webview.controller;
                
                import javax.annotation.Resource;
                import javax.servlet.http.HttpServletRequest;
                
                import org.springframework.stereotype.Controller;
                import org.springframework.ui.Model;
                import org.springframework.web.bind.annotation.GetMapping;
                import org.springframework.web.bind.annotation.RequestMapping;
                import org.springframework.web.bind.annotation.RequestParam;
                
                import chat.webview.service.ChatService;
                
                @Controller
                @RequestMapping("/webview")
                public class ChatController {
                
                	@Resource(name = "ChatService")
                	private ChatService chatService;
                	
                	@GetMapping("/index")
                	public String index() {
                		System.out.println("hello");
                		return "index";
                	}
                	
                	@GetMapping("/login")
                	public String login() {
                		return "login";
                	}
                	
                	@GetMapping("/chat")
                	public String chatRoom() {
                		return "roomlist";
                	}
                	
                	@GetMapping("/chat/rooms")
                	public String enterRoom(HttpServletRequest request, @RequestParam("roomName") String roomName, Model model) {
                		String clientIP = request.getRemoteAddr();  // í´ë¼ì´ì–¸íŠ¸ IP
                        int clientPort = request.getRemotePort();  // í´ë¼ì´ì–¸íŠ¸ í¬íŠ¸ ë²ˆí˜¸
                        System.out.println(clientIP + ":" + clientPort);
                        model.addAttribute("roomName", roomName);
                		return "client";
                	}
                }
                
                ```
                
        2. ChatService(êµ¬í˜„ x)
            - ì½”ë“œ ë³´ê¸°
                
                ```java
                package chat.webview.service;
                
                public interface ChatService {
                
                }
                
                ```
                
        3. ChatServiceImpl(êµ¬í˜„ x)
            - ì½”ë“œ ë³´ê¸°
                
                ```java
                package chat.webview.service.impl;
                
                import org.egovframe.rte.fdl.cmmn.EgovAbstractServiceImpl;
                import org.springframework.stereotype.Service;
                
                import chat.webview.service.ChatService;
                
                @Service("ChatService")
                public class ChatServiceImpl extends EgovAbstractServiceImpl implements ChatService{
                
                }
                
                ```
                
        4. ChatMapper(êµ¬í˜„ x)
            - ì½”ë“œ ë³´ê¸°
                
                ```java
                package chat.webview.mapper;
                
                import org.egovframe.rte.psl.dataaccess.mapper.Mapper;
                
                @Mapper("ChatMapper")
                public interface ChatMapper {
                
                }
                
                ```
                
        5. ChatMapper.xml
            - ì½”ë“œ ë³´ê¸°
                
                ```xml
                <?xml version="1.0" encoding="UTF-8" ?>
                <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
                	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
                 
                <mapper namespace="chat.webview.mapper.ChatMapper">
                
                </mapper>
                ```
                
3. ê²ªì€ ë¬¸ì œì 
    
    [@ServerEndpointë¥¼ ì‚¬ìš©í•œ í´ë˜ìŠ¤ì—ì„œ @Autowiredë¡œ ì£¼ì…í•œ í´ë˜ìŠ¤ê°€ nullì´ ë˜ëŠ” ê²½ìš°](https://www.notion.so/ServerEndpoint-Autowired-null-1c7c8943a97a80fcad1fee52822fbd1c?pvs=21)