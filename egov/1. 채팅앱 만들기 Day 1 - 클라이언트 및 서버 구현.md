# ì±„íŒ…ì•± ë§Œë“¤ê¸° Day 2 - í´ë¼ì´ì–¸íŠ¸ ë° ì„œë²„ êµ¬í˜„ - 1

ìƒì„±ì¼: 2025ë…„ 3ì›” 24ì¼ ì˜¤í›„ 4:34

ì‘ì„±ì¼: 25.03.24

- â€» ì›ë˜ í´ë¼ì´ì–¸íŠ¸ í™”ë©´ì„ swingìœ¼ë¡œ êµ¬í˜„í•˜ë ¤ í–ˆìœ¼ë‚˜, ì›¹ í™”ë©´ìœ¼ë¡œ êµ¬í˜„í•˜ëŠ” ê²ƒì´ ë” ì‰¬ìš¸ ê²ƒ ê°™ì•„ ë³€ê²½

## 1. êµ¬í˜„í•œ ê¸°ëŠ¥

1. WebSocket ê¸°ë°˜ ê°„ë‹¨í•œ ì±„íŒ… ì„œë²„ ë° í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„

## 2. ì½”ë“œ

1. í´ë¼ì´ì–¸íŠ¸ (ì´ˆê¸° í™”ë©´ cursor ai í™œìš©)
    - ì½”ë“œ ë³´ê¸°
        1. client.html
            
            ```jsx
            <!DOCTYPE html>
            <html lang="ko">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>ì±„íŒ… ì• í”Œë¦¬ì¼€ì´ì…˜</title>
                <link rel="stylesheet" href="communication.css">
            </head>
            <body>
                <div class="container">
                    <!-- ì‚¬ì´ë“œë°” - ì°¸ê°€ì ëª©ë¡ -->
                    <div class="sidebar">
                        <div class="user-profile">
                            <img src="default-avatar.png" alt="í”„ë¡œí•„" class="profile-img">
                            <span class="username">ì‚¬ìš©ì ì´ë¦„</span>
                        </div>
                        <h3>ì°¸ê°€ì ëª©ë¡</h3>
                        <ul class="participants-list" id="participantsList">
                            <!-- ì°¸ê°€ìë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </ul>
                    </div>
            
                    <!-- ë©”ì¸ ì±„íŒ… ì˜ì—­ -->
                    <div class="main-content">
                        <!-- ì±„íŒ…ë°© ì •ë³´ -->
                        <div class="chat-header">
                            <h2>ì±„íŒ…ë°© ì´ë¦„</h2>
                            <span class="participant-count">ì°¸ê°€ì: 3ëª…</span>
                        </div>
            
                        <!-- ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ -->
                        <div class="chat-messages" id="chatMessages">
                            <!-- ë©”ì‹œì§€ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </div>
            
                        <!-- ë©”ì‹œì§€ ì…ë ¥ ì˜ì—­ -->
                        <div class="message-input-area">
                            <input type="text" id="messageInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
                            <button id="sendButton">ì „ì†¡</button>
                            <button id="fileButton" class="file-button">ğŸ“</button>
                        </div>
                    </div>
                </div>
                <script src="communication.js"></script>
            </body>
            </html>
            ```
            
        2. client.css
            
            ```css
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            body {
                font-family: 'Noto Sans KR', sans-serif;
                background-color: #f5f5f5;
            }
            
            .container {
                display: flex;
                height: 100vh;
                max-width: 1200px;
                margin: 0 auto;
                background-color: white;
            }
            
            /* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ë§ */
            .sidebar {
                width: 250px;
                background-color: #2c3e50;
                color: white;
                padding: 20px;
            }
            
            .user-profile {
                display: flex;
                align-items: center;
                margin-bottom: 20px;
                padding-bottom: 20px;
                border-bottom: 1px solid #34495e;
            }
            
            .profile-img {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                margin-right: 10px;
            }
            
            .participants-list {
                list-style: none;
            }
            
            .participants-list li {
                padding: 10px 0;
                display: flex;
                align-items: center;
            }
            
            /* ë©”ì¸ ì±„íŒ… ì˜ì—­ ìŠ¤íƒ€ì¼ë§ */
            .main-content {
                flex: 1;
                display: flex;
                flex-direction: column;
            }
            
            .chat-header {
                padding: 20px;
                background-color: #f8f9fa;
                border-bottom: 1px solid #dee2e6;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .chat-messages {
                flex: 1;
                padding: 20px;
                overflow-y: auto;
            }
            
            .message {
                margin-bottom: 15px;
                padding: 10px;
                border-radius: 10px;
                max-width: 70%;
            }
            
            .message.received {
                background-color: #f1f0f0;
                text-align: left;
            }
            
            .message.sent {
                background-color: #007bff;
                color: white;
                text-align: right;
            }
            
            .message-input-area {
                padding: 20px;
                border-top: 1px solid #dee2e6;
                display: flex;
                gap: 10px;
            }
            
            #messageInput {
                flex: 1;
                padding: 10px;
                border: 1px solid #dee2e6;
                border-radius: 5px;
            }
            
            button {
                padding: 10px 20px;
                border: none;
                border-radius: 5px;
                background-color: #007bff;
                color: white;
                cursor: pointer;
            }
            
            button:hover {
                background-color: #0056b3;
            }
            
            .file-button {
                padding: 10px 15px;
                font-size: 20px;
            }
            ```
            
        3. client.js
            
            ```jsx
            const USER = {
                connect: '1', // 1: ìƒˆë¡œ ìƒì„±ë¨ì„ ì˜ë¯¸í•¨
                name: "user" + Math.random(),
                message: null
            }
            
            const socket = new WebSocket('ws://localhost:12345');  // ì„œë²„ ì£¼ì†Œì™€ í¬íŠ¸ ì„¤ì •
            
            // ì„œë²„ - í´ë¼ì´ì–¸íŠ¸ ì†Œì¼“ ì—°ê²°
            socket.onopen = function(event) {
                console.log("WebSocket ì—°ê²° ì„±ê³µ");
                socket.send(JSON.stringify(USER));
            };
            
            // ì„œë²„ë¡œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” í•¨ìˆ˜
            function sendMessage() {
                const message = document.getElementById("messageInput").value;  // ì…ë ¥ëœ ë©”ì‹œì§€ ê°€ì ¸ì˜¤ê¸°
                USER.connect = '2';
                USER.message = message;
                socket.send(JSON.stringify(USER));  // ë©”ì‹œì§€ ì „ì†¡
                document.getElementById("messageInput").value = "";  // ì…ë ¥ì°½ ì´ˆê¸°í™”
            
                let selfMessage = "<div class='message sent'>" + 'ë‚˜: ' + message + "</div>";
                let chatMessages = document.getElementById("chatMessages");
                chatMessages.innerHTML += selfMessage;
            }
            
            // ë©”ì‹œì§€ ìˆ˜ì‹  ì²˜ë¦¬
            socket.onmessage = function(event) {
                const chatMessages = document.getElementById("chatMessages");
            
                let newMessage = "<div class='message received'>" + event.data + "</div>";
                chatMessages.innerHTML += newMessage;
            }
            
            // ì „ì†¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            document.getElementById("sendButton").addEventListener("click", sendMessage);
            
            ```
            
            - `const socket = new WebSocket('ws://{domain or ip address}:{port}');`
                - ì†Œì¼“ ìƒì„±. ì´ ë•Œ, ì£¼ì†ŒëŠ” ì—°ê²°í•˜ê³ ì í•  ì„œë²„ì˜ ì£¼ì†Œì™€ í¬íŠ¸ë²ˆí˜¸ë¥¼ ì„¤ì •
            - `socket.onopen`
                - ìƒì„±í•œ ì†Œì¼“ì„ ê¸°ë°˜ìœ¼ë¡œ ì†Œì¼“ ì—°ê²°
            - `socket.send()`
                - ì—°ê²°ëœ ìƒëŒ€ë°©ì—ê²Œ ë°ì´í„° ì „ì†¡
            - `socket.onmessage`
                - ìƒëŒ€ë°©ìœ¼ë¡œë¶€í„° ë©”ì‹œì§€ ìˆ˜ì‹ 
2. ì„œë²„
    - ì½”ë“œ ë³´ê¸°
        1. ChatServer.java
            
            ```java
            package chat;
            
            import java.net.InetSocketAddress;
            import java.util.ArrayList;
            import java.util.HashMap;
            import java.util.List;
            import java.util.Map;
            
            import org.java_websocket.WebSocket;
            import org.java_websocket.handshake.ClientHandshake;
            import org.java_websocket.server.WebSocketServer;
            
            import com.fasterxml.jackson.databind.ObjectMapper;
            
            public class ChatServer extends WebSocketServer {
            
                private static final int PORT = 12345;  // ì„œë²„ í¬íŠ¸ ë²ˆí˜¸
                private List<User> users;
            
                public static void main(String[] args) {
                    ChatServer server = new ChatServer(PORT);
                    server.start();
                    System.out.println("ì±„íŒ… ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤...");
                }
            
                public ChatServer(int port) {
                    super(new InetSocketAddress("127.0.0.1", port));
                }
            
                @Override
                public void onOpen(WebSocket conn, ClientHandshake handshake) {
                	InetSocketAddress isa = (InetSocketAddress) conn.getRemoteSocketAddress();
                    System.out.println("ìƒˆ í´ë¼ì´ì–¸íŠ¸ ì—°ê²°ë¨: " + isa.getAddress().getHostAddress() + ":" + isa.getPort());
                    conn.send("ì„œë²„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤!");  // ìƒˆë¡œ ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë©”ì‹œì§€ ì „ì†¡
                }
            
                @Override
                public void onClose(WebSocket conn, int code, String reason, boolean remote) {
                    System.out.println("í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ì¢…ë£Œ: " + conn.getRemoteSocketAddress());
                    for (User user : users) {
                        // í˜„ì¬ í´ë¼ì´ì–¸íŠ¸ì—ê²ŒëŠ” ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ì§€ ì•ŠìŒ
                        if (user.getWebSocket() == conn) {
                            users.remove(user);
                            break;
                        }
                    }
                }
            
                @Override
                public void onMessage(WebSocket conn, String message) {
                	
                    try {
                        // ë©”ì‹œì§€ë¥¼ JSON ê°ì²´ë¡œ ë³€í™˜
                        Map<String, Object> userInfo = new HashMap<>();
                        userInfo = new ObjectMapper().readValue(message, Map.class);
                        System.out.println("í´ë¼ì´ì–¸íŠ¸ ì •ë³´: " + userInfo);
                        
                        String connect = (String) userInfo.get("connect");
                        if (connect == null) {
                        	return;
                        }
                        
                        if (connect.equals("1")) {
                        	String name = (String) userInfo.get("name");
                        	InetSocketAddress isa = (InetSocketAddress) conn.getRemoteSocketAddress();
                            System.out.println("ìƒˆ í´ë¼ì´ì–¸íŠ¸ ì—°ê²°ë¨: " + name + " | " + isa.getAddress().getHostAddress() + ":" + isa.getPort());
                            User user = new User(name, isa.getAddress().getHostAddress(), isa.getPort(), conn);
                            users.add(user);
                        } else {
                            System.out.println("ë°›ì€ ë©”ì‹œì§€: " + userInfo.get("message"));
                            for (User user : users) {
                                // í˜„ì¬ í´ë¼ì´ì–¸íŠ¸ì—ê²ŒëŠ” ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ì§€ ì•ŠìŒ
                                if (user.getWebSocket() != conn) {
                                    user.getWebSocket().send(userInfo.get("name") + ": " + (String) userInfo.get("message"));
                                }
                            }
                        }
                    } catch (Exception e) {
                        e.printStackTrace();
                        conn.send("ì˜ëª»ëœ í˜•ì‹ì˜ ë©”ì‹œì§€ì…ë‹ˆë‹¤.");
                    }
                }
            
                @Override
                public void onError(WebSocket conn, Exception ex) {
                    ex.printStackTrace();
                }
            
                @Override
                public void onStart() {
                    System.out.println("ì„œë²„ ì‹œì‘ë¨...");
                    users = new ArrayList<>();
                }
            }
            
            ```
            
            - `WebSocketServer`
                - Javaì—ì„œ ì›¹ì†Œì¼“ ì„œë²„ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•œ í´ë˜ìŠ¤
                - êµ¬í˜„í•  ì„œë²„ í´ë˜ìŠ¤ëŠ” `WebSocketServer` ë¥¼ ìƒì†ë°›ë„ë¡ í•¨
                - `onOpen()` : í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— ì—°ê²°ë˜ì—ˆì„ ë•Œ í˜¸ì¶œ
                - `onClose()` : í´ë¼ì´ì–¸íŠ¸ì™€ì˜ ì—°ê²°ì´ ì¢…ë£Œë˜ì—ˆì„ ë•Œ í˜¸ì¶œ
                - `onMessage()` : í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ë©”ì‹œì§€ê°€ ìˆ˜ì‹ ë˜ì—ˆì„ ë•Œ í˜¸ì¶œ
                - `onError()` : í´ë¼ì´ì–¸íŠ¸ì™€ì˜ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ë•Œ í˜¸ì¶œ
                - `onStart()` : ì„œë²„ê°€ ì‹œì‘ë  ë•Œ í˜¸ì¶œ
            - `InetSocketAddress`
                - ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì— ì‚¬ìš©ë˜ëŠ” ì£¼ì†Œë¥¼ ë‚˜íƒ€ë‚´ëŠ” í´ë˜ìŠ¤
                - IPì£¼ì†Œì™€ PORTë²ˆí˜¸ë¥¼ ê°€ì§€ê³  ìˆìŒ
            - `WebSocket`
                - ì›¹ì†Œì¼“ ì—°ê²°ì„ ê´€ë¦¬
                - ì›¹ì†Œì¼“ì— ëŒ€í•œ ì •ë³´ê°€ ë“¤ì–´ìˆìŒ
        
        1. User.java
            
            ```java
            package chat;
            
            import org.java_websocket.WebSocket;
            
            public class User {
                private String name;
                private String ip;
                private int port;
                private WebSocket webSocket;
            
                public User(String name, String ip, int port) {
                    this.name = name;
                    this.ip = ip;
                    this.port = port;
                }
            
                // WebSocket ê°ì²´ë¥¼ ì¶”ê°€í•œ ìƒì„±ì
                public User(String name, String ip, int port, WebSocket webSocket) {
                    this.name = name;
                    this.ip = ip;
                    this.port = port;
                    this.webSocket = webSocket;
                }
            
                public String getName() {
                    return name;
                }
                
                public String getIp() {
                    return ip;
                }
                
                public int getPort() {
                    return port;
                }
            
                public WebSocket getWebSocket() {
                    return webSocket;
                }
            }
            
            ```